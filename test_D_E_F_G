import docx
import json

# ==== CONFIG ====
docx_path = r"C:\Users\mahaf\Downloads\crs sp2.w.docx"  # ← عدّل المسار إذا تغير الملف
output_json_path = "C:\\Users\\mahaf\\Downloads\\section_e_output.json"

def extract_sections_e_f_g(file_path):
    doc = docx.Document(file_path)

    data = {
        "References and Learning Resources": {
            "Essential References": [],
            "Supportive References": [],
            "Electronic Materials": [],
            "Other Learning Materials": []
        },
        "Required Facilities and Equipment": {
            "Facilities": "",
            "Technology equipment": "",
            "Other equipment": ""
        },
        "Assessment of Course Quality": [],
        "Specification Approval": {
            "Council/Committee": "",
            "Reference Number": "",
            "Date": ""
        }
    }

    for table in doc.tables:
        first_row = [cell.text.strip().lower() for cell in table.rows[0].cells]

        # === Section E: References and Equipment ===
        if len(table.columns) == 2:
            for row in table.rows:
                cells = [cell.text.strip() for cell in row.cells]
                if len(cells) != 2:
                    continue
                key, value = cells
                key_lower = key.lower()

                if "essential references" in key_lower:
                    data["References and Learning Resources"]["Essential References"].append(value)
                elif "supportive references" in key_lower:
                    data["References and Learning Resources"]["Supportive References"].append(value)
                elif "electronic materials" in key_lower:
                    data["References and Learning Resources"]["Electronic Materials"].append(value)
                elif "other learning materials" in key_lower:
                    data["References and Learning Resources"]["Other Learning Materials"].append(value)
                elif "facilities" in key_lower:
                    data["Required Facilities and Equipment"]["Facilities"] = value
                elif "technology equipment" in key_lower:
                    data["Required Facilities and Equipment"]["Technology equipment"] = value
                elif "other equipment" in key_lower:
                    data["Required Facilities and Equipment"]["Other equipment"] = value

        # === Section F: Course Quality Assessment ===
        elif (
            "assessment areas/issues" in first_row and
            "assessor" in first_row and
            "assessment methods" in first_row
        ):
            for row in table.rows[1:]:
                cells = [cell.text.strip() for cell in row.cells]
                if len(cells) >= 3:
                    data["Assessment of Course Quality"].append({
                        "Area/Issue": cells[0],
                        "Assessor": cells[1],
                        "Method": cells[2]
                    })

        # === Section G: Specification Approval (assumed last table with keywords)
        elif any("committee" in cell for cell in first_row) and any("reference" in cell for cell in first_row):
            for row in table.rows[1:]:
                cells = [cell.text.strip() for cell in row.cells]
                if len(cells) >= 3:
                    data["Specification Approval"]["Council/Committee"] = cells[0]
                    data["Specification Approval"]["Reference Number"] = cells[1]
                    data["Specification Approval"]["Date"] = cells[2]
                    break  # found it; stop

    return data

# ==== RUN ====
combined_data = extract_sections_e_f_g(docx_path)

with open(output_json_path, "w", encoding="utf-8") as f:
    json.dump(combined_data, f, ensure_ascii=False, indent=2)

print("✅ Sections E, F & G extracted and saved to:", output_json_path)
